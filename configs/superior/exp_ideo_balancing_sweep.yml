exp_id: ideo_balancing_sweep
description: >
  Étude de l'impact des stratégies d'équilibrage
  sur web1 (mono-corpus) et web1+asr1 (multi-corpus juxtaposé),
  avec le profil ideo_quick.

base:
  profile: ideo_quick
  stage: pipeline
  make_vars:
    HARDWARE_PRESET: small
    TRAIN_PROP: 0.8
    MAX_DOCS_SKLEARN: 100
    MAX_DOCS_SPACY: 100
    MAX_DOCS_HF: 20
  overrides:
    view: ideology_global
    max_docs_global: 1500

axes:
  - name: dataset
    type: choice
    values:
      - label: web1_only
        overrides:
          dataset_id: web1
          data.corpus_ids: [web1]
          data.merge_mode: single
          analysis.compare_by: []

#      - label: web1_asr1_juxt
#        overrides:
#          dataset_id: web1_asr1
#          data.corpus_ids: [web1, asr1]
#          data.merge_mode: juxtaposed
#          data.source_field: corpus_id
#          analysis.compare_by: [corpus_id]

  - name: balance_strategy
    type: choice
    values:
      - label: no_balance
        make_vars:
          BALANCE_STRATEGY: none
      - label: oversample_parity
        make_vars:
          BALANCE_STRATEGY: oversample
          BALANCE_PRESET: parity

  - name: family_model
    type: choice
    values:
      - label: sklearn_svm
        make_vars:
          FAMILY: sklearn
        overrides:
          families: [sklearn]
          models_sklearn: [tfidf_svm_quick]

      - label: spacy_cnn
        make_vars:
          FAMILY: spacy
        overrides:
          families: [spacy]
          models_spacy: [spacy_cnn_quick]

grid:
  mode: cartesian

run:
  repeats: 1
  seed_strategy: per_run    # fixed | per_run
  base_seed: 42

scheduler:
  parallel: 1
  max_ram_gb: 14
  resource_classes:
    check: light
    sklearn: light
    spacy: heavy
    hf: heavy
  weights:
    light: 1
    medium: 2
    heavy: 4
  max_weight: 4
  approx_ram_per_class:      # Go estimés par run, pour la limite soft
    light: 2.0
    medium: 4.0
    heavy: 8.0

safety:
  enable_hard_ram_limit: false
  hard_limit_mb: null

oom_policy:
  on_oom: "skip"             # "skip" | "backoff" | "stop"
  backoff_factor: 0.5

early_stop:
  enabled: true
  min_accuracy: 0.30
  min_macro_f1: 0.25
  apply_to_families: [spacy, hf]

analysis_hooks:
  after_experiment:
    - type: curves
      metrics: [accuracy, macro_f1]
      x_axis: TRAIN_PROP
      group_by: [family, dataset_id]

    - type: report_markdown
      path: superior/${exp_id}/report.md
